<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini-GFS - Interfaz Web</title>
    <link rel="stylesheet" href="/style.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
    <header>
        <h1>ğŸ–¥ï¸ Mini-GFS - Interfaz Web</h1>
        <p>Sistema de Archivos Distribuido - Simulador Educativo</p>
    </header>

    <div class="container">
        <!-- Panel de Control del Sistema -->
        <section class="panel system-control">
            <h2>âš™ï¸ Control del Sistema</h2>
            <div class="control-buttons">
                <button id="btn-start" onclick="startSystem()">â–¶ï¸ Iniciar Sistema</button>
                <button id="btn-stop" onclick="stopSystem()">â¹ï¸ Detener Sistema</button>
                <button onclick="updateSystemStatus()">ğŸ”„ Actualizar Estado</button>
            </div>
            <div class="status-display">
                <div class="status-item">
                    <span class="status-label">Master:</span>
                    <span id="master-status" class="status-indicator">â—</span>
                    <span id="master-pid"></span>
                </div>
                <div class="status-item">
                    <span class="status-label">ChunkServer 1:</span>
                    <span id="cs1-status" class="status-indicator">â—</span>
                    <span id="cs1-pid"></span>
                </div>
                <div class="status-item">
                    <span class="status-label">ChunkServer 2:</span>
                    <span id="cs2-status" class="status-indicator">â—</span>
                    <span id="cs2-pid"></span>
                </div>
                <div class="status-item">
                    <span class="status-label">ChunkServer 3:</span>
                    <span id="cs3-status" class="status-indicator">â—</span>
                    <span id="cs3-pid"></span>
                </div>
            </div>
        </section>

        <!-- Panel de VisualizaciÃ³n de Red -->
        <section class="panel network-topology">
            <h2>ğŸŒ TopologÃ­a del Sistema GFS</h2>
            <div class="info-box">
                <p><strong>Â¿QuÃ© es la topologÃ­a de red?</strong></p>
                <p>La topologÃ­a muestra cÃ³mo estÃ¡n conectados los componentes del sistema GFS. El Master es el coordinador central que gestiona todos los metadatos, mientras que los ChunkServers almacenan los datos (chunks) en disco. Las conexiones representan la comunicaciÃ³n entre componentes (heartbeats y registro).</p>
            </div>
            <div class="topology-controls">
                <button onclick="loadNetworkTopology()">ğŸ”„ Actualizar TopologÃ­a</button>
            </div>
            <div id="topology-container" class="topology-visualization">
                <svg id="topology-svg" width="100%" height="500"></svg>
            </div>
            <div class="legend">
                <div class="legend-item">
                    <span class="legend-color" style="background: #3498db;"></span>
                    <span>Master (Coordinador Central)</span>
                </div>
                <div class="legend-item">
                    <span class="legend-color" style="background: #2ecc71;"></span>
                    <span>ChunkServer Vivo</span>
                </div>
                <div class="legend-item">
                    <span class="legend-color" style="background: #e74c3c;"></span>
                    <span>ChunkServer Muerto</span>
                </div>
                <div class="legend-item">
                    <span class="legend-line" style="background: gray;"></span>
                    <span>ConexiÃ³n (Heartbeat/Registro)</span>
                </div>
            </div>
        </section>

        <!-- Panel de DistribuciÃ³n de Chunks -->
        <section class="panel chunk-distribution">
            <h2>ğŸ“¦ DistribuciÃ³n de Chunks en el Sistema</h2>
            <div class="info-box">
                <p><strong>Â¿QuÃ© es un chunk?</strong></p>
                <p>Un chunk es una porciÃ³n de un archivo (tÃ­picamente 1MB en este simulador). Cada chunk se replica en mÃºltiples ChunkServers para tolerancia a fallos. El replication_factor determina cuÃ¡ntas copias de cada chunk existen. Si un ChunkServer falla, el sistema re-replica automÃ¡ticamente.</p>
            </div>
            <div class="distribution-controls">
                <div class="view-selector">
                    <label>
                        <input type="radio" name="view-type" value="general" checked onchange="updateChunkDistributionView()">
                        Vista General
                    </label>
                    <label>
                        <input type="radio" name="view-type" value="file" onchange="updateChunkDistributionView()">
                        Vista por Archivo
                    </label>
                </div>
                <select id="file-selector" style="display: none;" onchange="loadChunkDistribution()">
                    <option value="">Seleccionar archivo...</option>
                </select>
                <button onclick="loadChunkDistribution()">ğŸ”„ Actualizar DistribuciÃ³n</button>
            </div>
            <div id="distribution-container">
                <div id="distribution-general" class="distribution-view">
                    <h3>Vista General</h3>
                    <div id="distribution-chart" class="chart-container"></div>
                    <div id="distribution-table-container" class="table-container"></div>
                    <div id="distribution-network" class="network-graph"></div>
                </div>
                <div id="distribution-file" class="distribution-view" style="display: none;">
                    <h3>Vista por Archivo</h3>
                    <div id="file-chunks-diagram" class="chunks-diagram"></div>
                    <div id="file-chunks-table" class="table-container"></div>
                </div>
            </div>
        </section>

        <!-- Panel de Archivos -->
        <section class="panel files">
            <h2>ğŸ“ Archivos</h2>
            <div class="file-controls">
                <button onclick="loadFiles()">ğŸ”„ Actualizar Lista</button>
                <button onclick="showCreateFileDialog()">â• Crear Archivo</button>
            </div>
            <div id="files-list" class="files-list"></div>
            <div id="file-editor" class="file-editor" style="display: none;">
                <h3>Editor de Archivo</h3>
                <input type="text" id="file-path-input" placeholder="Ruta del archivo (ej: /mi_archivo.txt)">
                <textarea id="file-content-input" placeholder="Contenido del archivo..."></textarea>
                <button onclick="createFileFromEditor()">ğŸ’¾ Guardar Archivo</button>
            </div>
        </section>

        <!-- Panel de ConfiguraciÃ³n -->
        <section class="panel config">
            <h2>âš™ï¸ ConfiguraciÃ³n</h2>
            <div id="config-form" class="config-form">
                <div class="config-item">
                    <label>Replication Factor:</label>
                    <input type="number" id="config-replication" min="1" max="5" value="3">
                    <span class="config-help">NÃºmero de rÃ©plicas de cada chunk (1-5)</span>
                </div>
                <div class="config-item">
                    <label>Chunk Size (MB):</label>
                    <input type="number" id="config-chunk-size" min="1" value="1">
                    <span class="config-help">TamaÃ±o de cada chunk en megabytes</span>
                </div>
                <div class="config-item">
                    <label>Heartbeat Timeout (seg):</label>
                    <input type="number" id="config-heartbeat" min="5" value="30">
                    <span class="config-help">Tiempo antes de considerar un ChunkServer muerto</span>
                </div>
                <div class="config-item">
                    <label>Lease Duration (seg):</label>
                    <input type="number" id="config-lease" min="10" value="60">
                    <span class="config-help">DuraciÃ³n del lease para escrituras</span>
                </div>
                <button onclick="updateConfig()">ğŸ’¾ Aplicar ConfiguraciÃ³n</button>
            </div>
        </section>

        <!-- Panel de MÃ©tricas -->
        <section class="panel metrics">
            <h2>ğŸ“Š MÃ©tricas en Tiempo Real</h2>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-label">ChunkServers Vivos</div>
                    <div class="metric-value" id="metric-alive">-</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">ChunkServers Muertos</div>
                    <div class="metric-value" id="metric-dead">-</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Total de Chunks</div>
                    <div class="metric-value" id="metric-chunks">-</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Chunks Sub-replicados</div>
                    <div class="metric-value" id="metric-under-replicated">-</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Total de Archivos</div>
                    <div class="metric-value" id="metric-files">-</div>
                </div>
            </div>
            <button onclick="loadMetrics()">ğŸ”„ Actualizar MÃ©tricas</button>
        </section>

        <!-- Panel de GrÃ¡ficas -->
        <section class="panel graphs">
            <h2>ğŸ“ˆ GrÃ¡ficas</h2>
            <div class="graph-controls">
                <button onclick="generatePerformanceGraph()">ğŸ“Š Generar GrÃ¡fica de Rendimiento</button>
                <button onclick="generateClusterView()">ğŸ¢ Generar Vista del Cluster</button>
                <button onclick="generateNetworkTopologyImage()">ğŸŒ Generar TopologÃ­a de Red</button>
                <button onclick="generateChunkDistributionImage()">ğŸ“¦ Generar DistribuciÃ³n de Chunks</button>
            </div>
            <div id="graph-display" class="graph-display"></div>
        </section>
    </div>

    <script src="/app.js"></script>
</body>
</html>

