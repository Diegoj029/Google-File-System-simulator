<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini-GFS - Interfaz Web</title>
    <link rel="stylesheet" href="/style.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
    <header>
        <h1>üñ•Ô∏è Mini-Google File System - Interfaz Web</h1>
        <p>Simulador de Sistema de Archivos Distribuido - Sistemas Operativos Avanzados</p>
    </header>

    <div class="container">
        <!-- Panel de Control del Sistema -->
        <section class="panel system-control">
            <h2>‚öôÔ∏è Control del Sistema</h2>
            <div class="control-buttons">
                <button id="btn-start" onclick="startSystem()">‚ñ∂Ô∏è Iniciar Sistema</button>
                <button id="btn-stop" onclick="stopSystem()">‚èπÔ∏è Detener Sistema</button>
                <button onclick="updateSystemStatus()">üîÑ Actualizar Estado</button>
            </div>
            <div class="status-display">
                <div class="status-item">
                    <span class="status-label">Master:</span>
                    <span id="master-status" class="status-indicator">‚óè</span>
                    <span id="master-pid"></span>
                </div>
                <div id="chunkservers-list" class="chunkservers-list">
                    <!-- Los ChunkServers se mostrar√°n din√°micamente aqu√≠ -->
                </div>
            </div>
            <div class="chunkserver-controls" style="margin-top: 15px;">
                <button onclick="addChunkserver()" style="background: #2ecc71; color: white; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer;">
                    ‚ûï Agregar ChunkServer
                </button>
            </div>
        </section>

        <!-- Panel de Visualizaci√≥n de Red -->
        <section class="panel network-topology">
            <h2>üåê Topolog√≠a del Sistema GFS</h2>
            <div class="info-box">
                <p><strong>¬øQu√© es la topolog√≠a de red?</strong></p>
                <p>La topolog√≠a muestra c√≥mo est√°n conectados los componentes del sistema GFS. El Master es el coordinador central que gestiona todos los metadatos, mientras que los ChunkServers almacenan los datos (chunks) en disco. Las conexiones representan la comunicaci√≥n entre componentes (heartbeats y registro).</p>
            </div>
            <div class="topology-controls">
                <button onclick="loadNetworkTopology()">üîÑ Actualizar Topolog√≠a</button>
            </div>
            <div id="topology-container" class="topology-visualization">
                <svg id="topology-svg" width="100%" height="500"></svg>
            </div>
            <div class="legend">
                <div class="legend-item">
                    <span class="legend-color" style="background: #3498db;"></span>
                    <span>Master (Coordinador Central)</span>
                </div>
                <div class="legend-item">
                    <span class="legend-color" style="background: #2ecc71;"></span>
                    <span>ChunkServer Vivo</span>
                </div>
                <div class="legend-item">
                    <span class="legend-color" style="background: #e74c3c;"></span>
                    <span>ChunkServer Muerto</span>
                </div>
                <div class="legend-item">
                    <span class="legend-line" style="background: gray;"></span>
                    <span>Conexi√≥n (Heartbeat/Registro)</span>
                </div>
            </div>
        </section>

        <!-- Panel de Distribuci√≥n de Chunks -->
        <section class="panel chunk-distribution">
            <h2>üì¶ Distribuci√≥n de Chunks en el Sistema</h2>
            <div class="info-box">
                <p><strong>¬øQu√© es un chunk?</strong></p>
                <p>Un chunk es una porci√≥n de un archivo (t√≠picamente 1MB en este simulador). Cada chunk se replica en m√∫ltiples ChunkServers para tolerancia a fallos. El replication_factor determina cu√°ntas copias de cada chunk existen. Si un ChunkServer falla, el sistema re-replica autom√°ticamente.</p>
            </div>
            <div class="distribution-controls">
                <div class="view-selector">
                    <label>
                        <input type="radio" name="view-type" value="general" checked onchange="updateChunkDistributionView()">
                        Vista General
                    </label>
                    <label>
                        <input type="radio" name="view-type" value="file" onchange="updateChunkDistributionView()">
                        Vista por Archivo
                    </label>
                </div>
                <select id="file-selector" style="display: none;" onchange="loadChunkDistribution()">
                    <option value="">Seleccionar archivo...</option>
                </select>
                <button onclick="loadChunkDistribution()">üîÑ Actualizar Distribuci√≥n</button>
            </div>
            <div id="distribution-container">
                <div id="distribution-general" class="distribution-view">
                    <h3>Vista General</h3>
                    <div id="distribution-chart" class="chart-container"></div>
                    <div id="distribution-table-container" class="table-container"></div>
                    <div id="distribution-network" class="network-graph"></div>
                </div>
                <div id="distribution-file" class="distribution-view" style="display: none;">
                    <h3>Vista por Archivo</h3>
                    <div id="file-chunks-diagram" class="chunks-diagram"></div>
                    <div id="file-chunks-table" class="table-container"></div>
                </div>
            </div>
        </section>

        <!-- Panel de Archivos - Layout de dos columnas -->
        <div class="files-container">
            <!-- Columna izquierda: Operaciones -->
            <section class="panel files files-operations">
                <h2>üìÅ Operaciones de Archivos</h2>
                <div class="file-controls">
                    <button onclick="loadFiles()">üîÑ Actualizar Lista</button>
                    <button onclick="showFileOperationDialog('create')">‚ûï Crear Archivo</button>
                </div>
                
                <!-- Di√°logos de Operaciones -->
            <div id="file-operations" class="file-operations">
                <!-- Crear Archivo -->
                <div id="dialog-create" class="operation-dialog" style="display: none;">
                    <h3>Crear Archivo</h3>
                    <input type="text" id="create-path" placeholder="Ruta del archivo (ej: /mi_archivo.txt)">
                    <div class="dialog-buttons">
                        <button onclick="createFile()">Crear</button>
                        <button onclick="hideFileOperationDialog('create')">Cancelar</button>
                    </div>
                </div>
                
                <!-- Escribir en Archivo -->
                <div id="dialog-write" class="operation-dialog" style="display: none;">
                    <h3>Escribir en Archivo</h3>
                    <input type="text" id="write-path" placeholder="Ruta del archivo">
                    <input type="number" id="write-offset" placeholder="Offset (bytes)" value="0">
                    <textarea id="write-content" placeholder="Contenido a escribir..."></textarea>
                    <div class="dialog-buttons">
                        <button onclick="writeFile()">Escribir</button>
                        <button onclick="hideFileOperationDialog('write')">Cancelar</button>
                    </div>
                </div>
                
                <!-- Leer Archivo -->
                <div id="dialog-read" class="operation-dialog" style="display: none;">
                    <h3>Leer Archivo</h3>
                    <input type="text" id="read-path" placeholder="Ruta del archivo">
                    <input type="number" id="read-offset" placeholder="Offset (bytes)" value="0">
                    <input type="number" id="read-length" placeholder="Longitud (bytes)" value="100">
                    <div class="dialog-buttons">
                        <button onclick="readFile()">Leer</button>
                        <button onclick="hideFileOperationDialog('read')">Cancelar</button>
                    </div>
                    <div id="read-result" class="read-result" style="display: none;">
                        <h4>Resultado:</h4>
                        <pre id="read-content"></pre>
                    </div>
                </div>
                
                <!-- Append a Archivo -->
                <div id="dialog-append" class="operation-dialog" style="display: none;">
                    <h3>A√±adir al Final del Archivo</h3>
                    <input type="text" id="append-path" placeholder="Ruta del archivo">
                    <textarea id="append-content" placeholder="Contenido a a√±adir..."></textarea>
                    <div class="dialog-buttons">
                        <button onclick="appendFile()">A√±adir</button>
                        <button onclick="hideFileOperationDialog('append')">Cancelar</button>
                    </div>
                </div>
                
                <!-- Informaci√≥n de Archivo (ls) -->
                <div id="dialog-info" class="operation-dialog" style="display: none;">
                    <h3>Informaci√≥n de Archivo</h3>
                    <input type="text" id="info-path" placeholder="Ruta del archivo">
                    <div class="dialog-buttons">
                        <button onclick="getFileInfo()">Obtener Info</button>
                        <button onclick="hideFileOperationDialog('info')">Cancelar</button>
                    </div>
                    <div id="info-result" class="info-result" style="display: none;">
                        <h4>Informaci√≥n:</h4>
                        <pre id="info-content"></pre>
                    </div>
                </div>
                
                <!-- Snapshot -->
                <div id="dialog-snapshot" class="operation-dialog" style="display: none;">
                    <h3>Crear Snapshot</h3>
                    <input type="text" id="snapshot-source" placeholder="Ruta del archivo fuente">
                    <input type="text" id="snapshot-dest" placeholder="Ruta del snapshot destino">
                    <div class="dialog-buttons">
                        <button onclick="snapshotFile()">Crear Snapshot</button>
                        <button onclick="hideFileOperationDialog('snapshot')">Cancelar</button>
                    </div>
                </div>
                
                <!-- Renombrar Archivo -->
                <div id="dialog-rename" class="operation-dialog" style="display: none;">
                    <h3>Renombrar Archivo</h3>
                    <input type="text" id="rename-old" placeholder="Ruta antigua">
                    <input type="text" id="rename-new" placeholder="Ruta nueva">
                    <div class="dialog-buttons">
                        <button onclick="renameFile()">Renombrar</button>
                        <button onclick="hideFileOperationDialog('rename')">Cancelar</button>
                    </div>
                </div>
                
                <!-- Eliminar Archivo -->
                <div id="dialog-delete" class="operation-dialog" style="display: none;">
                    <h3>Eliminar Archivo</h3>
                    <input type="text" id="delete-path" placeholder="Ruta del archivo a eliminar">
                    <div class="dialog-buttons">
                        <button onclick="deleteFile()" class="danger">Eliminar</button>
                        <button onclick="hideFileOperationDialog('delete')">Cancelar</button>
                    </div>
                </div>
            </div>
            
                <!-- Botones de Operaciones R√°pidas -->
                <div class="file-quick-actions">
                    <h3>Operaciones R√°pidas</h3>
                    <div class="quick-actions-grid">
                        <button onclick="showFileOperationDialog('write')">‚úèÔ∏è Escribir</button>
                        <button onclick="showFileOperationDialog('read')">üëÅÔ∏è Leer</button>
                        <button onclick="showFileOperationDialog('append')">‚ûï A√±adir</button>
                        <button onclick="showFileOperationDialog('info')">‚ÑπÔ∏è Informaci√≥n</button>
                        <button onclick="showFileOperationDialog('snapshot')">üì∏ Snapshot</button>
                        <button onclick="showFileOperationDialog('rename')">‚úèÔ∏è Renombrar</button>
                        <button onclick="showFileOperationDialog('delete')">üóëÔ∏è Eliminar</button>
                    </div>
                </div>
            </section>
            
            <!-- Columna derecha: Lista de Archivos -->
            <section class="panel files files-list-panel">
                <h2>üìã Lista de Archivos</h2>
                <div id="files-list" class="files-list"></div>
            </section>
        </div>

        <!-- Panel de Configuraci√≥n -->
        <section class="panel config">
            <h2>‚öôÔ∏è Configuraci√≥n</h2>
            <div id="config-form" class="config-form">
                <div class="config-item">
                    <label>Replication Factor:</label>
                    <input type="number" id="config-replication" min="1" max="5" value="3">
                    <span class="config-help">N√∫mero de r√©plicas de cada chunk (1-5)</span>
                </div>
                <div class="config-item">
                    <label>Chunk Size (MB):</label>
                    <input type="number" id="config-chunk-size" min="1" value="1">
                    <span class="config-help">Tama√±o de cada chunk en megabytes</span>
                </div>
                <div class="config-item">
                    <label>Heartbeat Timeout (seg):</label>
                    <input type="number" id="config-heartbeat" min="5" value="30">
                    <span class="config-help">Tiempo antes de considerar un ChunkServer muerto</span>
                </div>
                <div class="config-item">
                    <label>Lease Duration (seg):</label>
                    <input type="number" id="config-lease" min="10" value="60">
                    <span class="config-help">Duraci√≥n del lease para escrituras</span>
                </div>
                <button onclick="updateConfig()">üíæ Aplicar Configuraci√≥n</button>
            </div>
        </section>

        <!-- Panel de M√©tricas -->
        <section class="panel metrics">
            <h2>üìä M√©tricas en Tiempo Real</h2>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-label">ChunkServers Vivos</div>
                    <div class="metric-value" id="metric-alive">-</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">ChunkServers Muertos</div>
                    <div class="metric-value" id="metric-dead">-</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Total de Chunks</div>
                    <div class="metric-value" id="metric-chunks">-</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Chunks Sub-replicados</div>
                    <div class="metric-value" id="metric-under-replicated">-</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Total de Archivos</div>
                    <div class="metric-value" id="metric-files">-</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Throughput (ops/s)</div>
                    <div class="metric-value" id="metric-throughput">-</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Latencia Promedio (ms)</div>
                    <div class="metric-value" id="metric-latency-avg">-</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Latencia P95 (ms)</div>
                    <div class="metric-value" id="metric-latency-p95">-</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Latencia P99 (ms)</div>
                    <div class="metric-value" id="metric-latency-p99">-</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Tasa de Fallos (fallos/hora)</div>
                    <div class="metric-value" id="metric-failure-rate">-</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Re-replicaciones Activas</div>
                    <div class="metric-value" id="metric-active-replications">-</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">R√©plicas Obsoletas</div>
                    <div class="metric-value" id="metric-stale-replicas">-</div>
                </div>
            </div>
            <div class="metrics-details" id="metrics-details" style="margin-top: 20px; display: none;">
                <h3>Detalles Adicionales</h3>
                <div id="metrics-details-content"></div>
            </div>
            <button onclick="loadMetrics()">üîÑ Actualizar M√©tricas</button>
        </section>

        <!-- Panel de Gr√°ficas -->
        <section class="panel graphs">
            <h2>üìà Gr√°ficas</h2>
            <div class="graph-controls">
                <button onclick="generatePerformanceGraph()">üìä Generar Gr√°fica de Rendimiento</button>
                <button onclick="generateClusterView()">üè¢ Generar Vista del Cluster</button>
                <button onclick="generateNetworkTopologyImage()">üåê Generar Topolog√≠a de Red</button>
                <button onclick="generateChunkDistributionImage()">üì¶ Generar Distribuci√≥n de Chunks</button>
            </div>
            <div id="graph-display" class="graph-display"></div>
        </section>
    </div>

    <script src="/app.js"></script>
</body>
</html>

